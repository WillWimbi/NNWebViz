<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>MNIST Mega Prototype</title>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
  <style>
    /* Basic layout */
    body {
      margin: 0; 
      font-family: sans-serif;
    }
    #canvasChart {
      border: 1px solid #444;
      background: #fff;
    }
    #embedding-canvas {
      border: 1px solid #444;
      background: #fff;
    }

    /* Draggable block builder UI */
    .container {
      display: flex; gap: 20px; margin-top: 10px;
    }
    .source-area, .target-area {
      border: 2px solid black; padding: 20px; min-height: 300px; width: 200px;
    }
    .block {
      background-color: lightblue; padding: 10px; margin-bottom: 10px;
      border-radius: 5px; cursor: grab; position: relative;
    }
    .trash-icon {
      position: absolute; top: 0px; right: 0px; cursor: pointer;
      font-size: 16px; z-index: 10;
    }
    .target-container {
      display: flex; flex-direction: column;
      border: 2px solid black; padding: 0; min-height: 300px; width: 200px;
    }
    .target-container h4 {
      margin: 0; padding: 10px; background-color: #e0e0e0;
      text-align: center; border-bottom: 1px solid #ccc;
    }
    .target-area {
      background-color: #f0f0f0; min-height: 260px; padding: 20px;
    }
    .drop-zone {
      position: relative; width: 100%; height: 3px;
      background-color: #00aeff; text-align: center; margin: 5px 0; border-radius: 5px;
    }
    .drop-zone-active {
      background-color: #66ccff;
      box-shadow: 0 0 5px rgba(0, 174, 255, 0.5);
      transition: all 0.2s ease;
    }
    .layer-component {
      display: inline-block; margin: 5px; padding: 5px;
      background: #cfc; border: 1px solid #aaa; cursor: pointer;
    }
    #box { margin: 5px; }

    /* Leaderboard list */
    #leaderboard {
      border: 1px solid #666; padding: 5px; width: 300px; background: #fafafa;
      max-height: 300px; overflow-y: auto; margin: 10px 0;
    }
    #logArea {
      width: 95%; height: 150px; border: 1px solid #999;
      background: #f3f3f3; font-family: monospace; white-space: pre;
      overflow-y: auto; margin: 10px 0;
    }

    /* “Worst performers” images UI */
    .thumb {
      display: inline-block; margin: 5px; border: 1px solid #999;
      text-align: center; width: 60px; font-size: 12px; cursor: pointer;
    }
    .thumb img {
      display: block; margin: auto; width: 28px; height: 28px; /* MNIST scale */
    }
  </style>
</head>

<body>

<div style="margin:10px;">
  <canvas id="canvasChart" width="600" height="200"></canvas>
  &nbsp; 
  <canvas id="embedding-canvas" width="400" height="200"></canvas>
</div>

<button id="trainBtn" class="btn btn-primary">Train Single Network</button>
<button id="validateBtn" class="btn btn-warning">Validate Model Blocks</button>
<button id="run100Btn" class="btn btn-success">Run 100 Versions (No changes)</button>
<button id="saveLeaderboardBtn" class="btn btn-info">Save to Leaderboard</button>
<br>

<div id="leaderboard"><strong>Leaderboard (lowest valLoss first):</strong><br></div>

<div id="logArea">Logs here...</div>

<div id="loading-indicator" style="display:none; position: fixed; top: 50%; left: 50%;
     transform: translate(-50%, -50%); border:2px solid #666; background:#fffd; 
     padding:20px; font-weight:bold; text-align:center;">
  Loading...
</div>

<!-- The user’s drag-drop network builder -->

<div class="container">
  <div class="source-area">
    <!-- Conv2D -->
    <div class="block" id="conv2d" draggable="true" data-type="conv2d">
      <h4>Conv2D Layer</h4>
      Kernel&nbsp;<input data-param="kernelSize"  placeholder="3">
      Filters&nbsp;<input data-param="filters"    placeholder="32">
      Strides&nbsp;<input data-param="strides"    placeholder="1">
    </div>

    <!-- MaxPooling -->
    <div class="block" id="maxpool" draggable="true" data-type="maxpool">
      <h4>MaxPool2D</h4>
      Pool&nbsp;<input data-param="poolSize" placeholder="2">
    </div>

    <!-- Activation: Sigmoid -->
    <div class="block" id="sigmoid" draggable="true" data-type="sigmoid">
      <h4>Sigmoid</h4>
    </div>

    <!-- Activation: Tanh -->
    <div class="block" id="tanh" draggable="true" data-type="tanh">
      <h4>Tanh</h4>
    </div>

    <!-- Activation: ReLU (the user had it in code) -->
    <div class="block" id="relu" draggable="true" data-type="relu">
      <h4>ReLU Activation Function</h4>
    </div>

    <!-- Dense -->
    <div class="block" id="dense" draggable="true" data-type="dense">
      <h4>Dense Layer</h4>
      In <input data-param="inputChannels" placeholder="64">
      Out <input data-param="outputChannels" placeholder="10">
    </div>

    <!-- Compile / Loss block -->
    <div class="block" id="loss" draggable="true" data-type="loss">
      <h4>Compile / Loss</h4>
      Optimizer
      <select data-param="optimizer">
        <option value="sgd" selected>SGD</option>
        <option value="adam">Adam</option>
        <option value="rmsprop">RMSProp</option>
      </select><br>
      Loss
      <select data-param="loss">
        <option value="categoricalCrossentropy" selected>Categorical CE</option>
        <option value="binaryCrossentropy">Binary CE</option>
        <option value="meanSquaredError">MSE</option>
      </select>
    </div>

    <!-- just a random example block -->
    <div class="block" draggable="true" id="block3" data-type="misc">
      Box 3 (no params)
    </div>
  </div>

  <div class="target-container">
    <h4 id="default-text">Drop boxes here</h4>
    <div class="target-area" id="target"></div>
  </div>
</div>

<!-- The raw MNIST canvas if needed, hidden, off-screen -->
<canvas id="canvas" width="300" height="300" style="display:none;"></canvas>

<script src="./data.js" type="module"></script>
<script src="./script.js" type="module"></script>

</body>
</html>
